#!/bin/bash

# Ensure target URL is passed as an argument
if [ -z "$1" ]; then
    echo "Usage: $0 <target-url>"
    exit 1
fi

TARGET_URL="$1"
CVE_SEARCH_PATH="cve-search"
OUTPUT_DIR="results"
OUTPUT_FILE="$OUTPUT_DIR/cve-search-results.txt"

# Ensure the output directory exists
mkdir -p "$OUTPUT_DIR"

# Clear the output file before starting
> "$OUTPUT_FILE"

echo "Performing CVE search for target: $TARGET_URL"

# Check if the CVE search script exists
if [ ! -f "$CVE_SEARCH_PATH/bin/search.py" ]; then
    echo "Error: CVE search script not found at $CVE_SEARCH_PATH/bin/search.py"
    exit 1
fi

# Define an array of CVE-Search commands specific to the target
declare -a COMMANDS=(
    "$CVE_SEARCH_PATH/bin/search.py -p $TARGET_URL -o json"
)

# Execute each command and save the output to cve-search-results.txt
for CMD in "${COMMANDS[@]}"; do
    echo "Running command: $CMD"
    eval "$CMD" >> "$OUTPUT_FILE"

    # Check if the command was successful
    if [ $? -eq 0 ]; then
        echo "CVE search results saved to $OUTPUT_FILE"
    else
        echo "CVE search failed for target: $TARGET_URL"
    fi
done
